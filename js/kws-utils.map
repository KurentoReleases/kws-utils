{"version":3,"file":"bundle.js","sources":["../node_modules/browserify/node_modules/browser-pack/_prelude.js","../lib/index.js","../lib/WebRtcPeer.js"],"names":["WebRtcPeer","require","exports","defaultOnerror","error","console","mode","localVideo","remoteVideo","onsdpoffer","onerror","videoStream","Object","defineProperty","this","writable","stream","prototype","start","self","pc","RTCPeerConnection","server","options","src","URL","createObjectURL","muted","addStream","constraints","mandatory","OfferToReceiveAudio","undefined","OfferToReceiveVideo","createOffer","offer","log","setLocalDescription","onicecandidate","e","candidate","offerSdp","localDescription","sdp","dispose","removeStream","close","processSdpAnswer","sdpAnswer","answer","RTCSessionDescription","type","setRemoteDescription","getRemoteStreams","iceServers","url","optional","DtlsSrtpKeyAgreement","onSdp","wp","getUserMedia","audio","video","userStream","startRecvOnly","onError","startSendOnly","startSendRecv","module"],"mappings":"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","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error(\"Cannot find module '\"+o+\"'\")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/*\n * (C) Copyright 2014 Kurento (http://kurento.org/)\n *\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the GNU Lesser General Public License\n * (LGPL) version 2.1 which accompanies this distribution, and is available at\n * http://www.gnu.org/licenses/lgpl-2.1.html\n *\n * This library is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n */\n\n/**\n * @module kwsUtils\n *\n * @copyright 2013 Kurento (http://kurento.org/)\n * @license LGPL\n */\n\nvar WebRtcPeer = require('./WebRtcPeer');\n\nexports.WebRtcPeer = WebRtcPeer;","function defaultOnerror(error) {\n\tconsole.error(error);\n}\n\nfunction WebRtcPeer(mode, localVideo, remoteVideo, onsdpoffer, onerror, videoStream) {\n\n\tObject.defineProperty(this, 'onsdpoffer', { writable: true});\n\n\tObject.defineProperty(this, 'onerror', { writable: true});\n\n\tObject.defineProperty(this, 'localVideo', { writable: true});\n\n\tObject.defineProperty(this, 'remoteVideo', { writable: true});\n\n\tObject.defineProperty(this, 'stream',  { writable: true});\n\n\tObject.defineProperty(this, 'pc', { writable: true});\n\n\tObject.defineProperty(this, 'mode', { writable: true});\n\n\tthis.localVideo = localVideo;\n\tthis.remoteVideo = remoteVideo;\n\tthis.onerror = (!onerror) ? defaultOnerror : onerror;\n\tthis.stream = videoStream;\n\tthis.mode = mode;\n\tthis.onsdpoffer = onsdpoffer;\n}\n\nWebRtcPeer.prototype.start = function() {\n\n\tvar self = this;\n\n\tif (!this.pc) {\n\t\tthis.pc = new RTCPeerConnection(this.server, this.options);\n\t}\n\n\tvar pc = this.pc;\n\n\tif (this.stream && this.localVideo) {\n\t\tthis.localVideo.src = URL.createObjectURL(this.stream);\n\t\tthis.localVideo.muted = true;\n\t}\n\n\tif (this.stream) {\n\t\tpc.addStream(this.stream);\n\t}\n\n\tvar constraints = {\n\t\t\tmandatory: {\n\t\t\t\tOfferToReceiveAudio: (this.remoteVideo !== undefined),\n\t\t\t\tOfferToReceiveVideo: (this.remoteVideo !== undefined)\n\t\t\t}\n\t};\n\n\tpc.createOffer(function(offer) {\n\t\tconsole.log('Created SDP offer');\n\t\tpc.setLocalDescription(offer, function() {\n\t\t\tconsole.log('Local description set');\n\t\t}, this.onerror);\n\n\t}, this.onerror, constraints);\n\n\tpc.onicecandidate = function (e) {\n\t\t// candidate exists in e.candidate\n\t\tif (e.candidate) return;\n\n\t\tvar offerSdp = pc.localDescription.sdp;\n\t\tconsole.log('ICE negotiation completed');\n\t\tif (self.onsdpoffer) {\n\t\t\tconsole.log('Invokin SDP offer callback function');\n\t\t\tself.onsdpoffer(offerSdp, self);\n\t\t}\n\t};\n\n}\n\nWebRtcPeer.prototype.dispose = function() {\n\tconsole.log('Disposing WebRtcPeer');\n\t//TODO don't know if we have to do this\n\tif (this.stream) this.pc.removeStream(this.stream);\n\tthis.pc.close();\n};\n\n\nWebRtcPeer.prototype.processSdpAnswer = function(sdpAnswer) {\n\tvar answer = new RTCSessionDescription({\n\t\ttype : 'answer',\n\t\tsdp : sdpAnswer,\n\t});\n\n\tconsole.log('SDP answer received, setting remote description');\n\tvar self = this;\n\tself.pc.setRemoteDescription(answer, function() {\n\t\tif (self.remoteVideo) {\n\t\t\tvar stream = self.pc.getRemoteStreams()[0];\n\t\t\tself.remoteVideo.src = URL.createObjectURL(stream);\n\t\t}\n\t}, this.onerror);\n}\n\nWebRtcPeer.prototype.server = {\n\t\ticeServers : [ {\n\t\t\turl : 'stun:stun.l.google.com:19302'\n\t\t} ]\n};\n\nWebRtcPeer.prototype.options = {\n\t\toptional : [ {\n\t\t\tDtlsSrtpKeyAgreement : true\n\t\t} ]\n};\n\nWebRtcPeer.start = function(mode, localVideo, remoteVideo, onSdp, onerror, videoStream) {\n\tvar wp = new WebRtcPeer(mode, localVideo, remoteVideo, onSdp, onerror, videoStream);\n\n\tif (wp.mode !== 'recv' && !wp.stream) {\n\t\tgetUserMedia({\n\t\t\t'audio' : true,\n\t\t\t'video' : true\n\t\t}, function(userStream) {\n\t\t\twp.stream = userStream;\n\t\t\twp.start();\n\t\t}, wp.onerror);\n\t} else {\n\t\twp.start();\n\t}\n\n\treturn wp;\n};\n\nWebRtcPeer.startRecvOnly = function (remoteVideo, onSdp, onError) {\n\treturn WebRtcPeer.start('recv', null, remoteVideo, onSdp, onError);\n};\n\nWebRtcPeer.startSendOnly = function (localVideo, onSdp, onError) {\n\treturn WebRtcPeer.start('send', localVideo, null, onSdp, onError);\n};\n\nWebRtcPeer.startSendRecv = function (localVideo, remoteVideo, onSdp, onError) {\n\treturn WebRtcPeer.start('sendRecv', localVideo, remoteVideo, onSdp, onError);\n};\n\nmodule.exports = WebRtcPeer;"]}